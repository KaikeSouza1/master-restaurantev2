generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Model para Administradores do Painel
model AdminUser {
  id       Int     @id @default(autoincrement())
  email    String  @unique @db.VarChar(255)
  password String  @db.VarChar(255)
  nome     String  @db.VarChar(255)
  isAdmin  Boolean @default(true)

  @@map("AdminUser")
}

// Model para Clientes do Cardápio/Delivery
model cliente_loja_virtual {
  codseq_clv      Int     @id
  nome_clv        String? @db.VarChar(100)
  email_clv       String? @db.VarChar(50)
  cpf_clv         String? @db.VarChar(20)
  telefone1_clv   String? @db.VarChar(20)
  acesso_clv      String? @db.VarChar(250) // Senha
  tipo_pessoa_clv String? @db.VarChar(2)
  // Outros campos podem ser adicionados se necessário
}

// Model para Produtos
model produtos {
  codinterno Decimal   @id @db.Decimal(16, 0)
  descricao  String?   @db.VarChar(350)
  preco      Decimal?  @default(0) @db.Decimal(14, 5)
  grupo      Int? // ID da Categoria
  inativo    String?   @default("") @db.VarChar(1)
  // Relacionamentos
  grupo_rel  grupo?    @relation("produtos_grupoTogrupo", fields: [grupo], references: [codigo])
  quitens    quitens[]

  @@index([descricao])
  @@index([grupo])
}

// Model para Grupos (Categorias)
model grupo {
  codigo           Int        @id(map: "gr1upcodgrupo")
  nome             String?    @db.VarChar(30)
  seq_loja_virtual Int?
  produtos         produtos[] @relation("produtos_grupoTogrupo")

  @@index([nome])
}

// Model para Informações da Empresa
model empresa {
  codigo Int     @id(map: "em1pcodempresa")
  nome   String? @db.VarChar(60)
  endere String? @db.VarChar(40)
  num    Int?    @db.SmallInt
  bairro String? @db.VarChar(30)
  cidade String? @db.VarChar(25)
  estado String? @db.VarChar(2)
  fone   String? @db.VarChar(12)
}

// ==========================================================
// TABELA PRINCIPAL PARA A LÓGICA DO RESTAURANTE (MESAS/PEDIDOS)
// ==========================================================
model quiosque {
  codseq             Int       @id(map: "kc1odseqquiosque")
  tipo               String?   @db.VarChar(1) // 'M' para Mesa, 'D' para Delivery
  num_quiosque       Int? // Número da Mesa
  data_hora_abertura DateTime? @db.Timestamp(6)
  vda_finalizada     String?   @db.VarChar(1) // 'N' (Não) ou 'S' (Sim) - CHAVE PARA NFCe
  obs                String?   @db.VarChar(149) // Usado para status (NOVO, PREPARANDO, PRONTO, PAGAMENTO)

  // Dados do Pedido
  nome_cli_esp     String?  @db.VarChar(29)
  fone_esp         String?  @db.VarChar(19)
  cod_endereco     Int?
  val_taxa_entrega Decimal? @db.Decimal(8, 2)
  sub_total_geral  Decimal? @default(0) @db.Decimal(8, 2)
  total            Decimal? @default(0) @db.Decimal(8, 2)

  data_hora_finalizada DateTime? @db.Timestamp(6) // Importante para o KDS de finalizados

  // Campos obrigatórios (mesmo que não usados ativamente na API)
  ean          String   @db.VarChar(13)
  loja_virtual Boolean?

  // Relacionamento com os Itens
  quitens      quitens[]
  mec_quiosque mec_quiosque[]
  qcadcheq     qcadcheq[]
  qui_maoobra  qui_maoobra[]
  quites       quites[]
  qupar        qupar[]

  @@index([num_quiosque])
  @@index([vda_finalizada])
  @@index([tipo])
}

// Model para Itens do Pedido (Mesa/Delivery)
model quitens {
  codseq    Int      @id(map: "kc1odseqquitens")
  codseq_qu Int? // ID do Quiosque (pedido)
  codprod   Decimal? @db.Decimal(16, 0) // ID do Produto
  descricao String?  @db.VarChar(100)
  qtd       Decimal? @default(0) @db.Decimal(12, 3)
  unitario  Decimal? @default(0) @db.Decimal(10, 3)
  total     Decimal? @default(0) @db.Decimal(8, 2)
  obs       String?  @db.VarChar(1000)

  // Relacionamentos
  quiosque quiosque? @relation(fields: [codseq_qu], references: [codseq], onDelete: Cascade)
  produtos produtos? @relation(fields: [codprod], references: [codinterno])

  @@index([codseq_qu])
}

// --- Tabelas de suporte (para o schema compilar) ---
// Estas tabelas são referenciadas por 'quiosque' mas não usadas na nossa API. 
// Mantemos elas vazias para o Prisma não dar erro.
model mec_quiosque {
  codseq           Int       @id(map: "kcodseq_mec_qui")
  cod_mecanico     Int?
  cod_seq_quiosque Int?
  quiosque         quiosque? @relation(fields: [cod_seq_quiosque], references: [codseq], onDelete: Cascade, map: "rel1_k_cod_seq_quiosque")
}

model qcadcheq {
  codseq    Int       @id(map: "kc1odseqqcadcheq")
  codseq_qu Int?
  quiosque  quiosque? @relation(fields: [codseq_qu], references: [codseq], onDelete: Cascade, map: "rel3_kcodseq_qu")
}

model qui_maoobra {
  codseq       Int       @id(map: "kcod_seq_qmobra")
  cod_quiosque Int?
  quiosque     quiosque? @relation(fields: [cod_quiosque], references: [codseq], onDelete: Cascade, map: "rel2_k_cod_quiosque")
}

model quites {
  codseq     Int       @id(map: "kc1odseqquites")
  codseq_qui Int?
  quiosque   quiosque? @relation(fields: [codseq_qui], references: [codseq], onDelete: Cascade, map: "rel1_kcod_seqqui")
}

model qupar {
  codseq    Int       @id(map: "kc1odseqqupar")
  codseq_qu Int?
  quiosque  quiosque? @relation(fields: [codseq_qu], references: [codseq], onDelete: Cascade, map: "rel1_kcodqui")
}
